# ãƒšãƒ¼ã‚¸ä¸€è¦§ã‹ã‚‰ã®ãƒšãƒ¼ã‚¸é·ç§»UXæ”¹å–„

**ä½œæˆæ—¥**: 2025-11-07  
**å„ªå…ˆåº¦**: ğŸ”´ High  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ“‹ Open  
**ã‚«ãƒ†ã‚´ãƒª**: UXæ”¹å–„ / ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ

---

## ğŸ“‹ å•é¡Œã®è¦ç´„

### ç¾åœ¨ã®å•é¡Œç‚¹

1. **è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®æ¬ å¦‚**
   - ãƒšãƒ¼ã‚¸ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ã€ã©ã®ãƒšãƒ¼ã‚¸ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã®ã‹ãŒã‚ã‹ã‚Šã«ãã„
   - ç‰¹ã«ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ã‚¿ãƒƒãƒ—ã—ãŸéš›ã®åå¿œãŒä¸æ˜ç¢º

2. **é·ç§»ã®é…å»¶**
   - ãƒšãƒ¼ã‚¸è©³ç´°ã¯ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒå®Œäº†ã™ã‚‹ã¾ã§ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„
   - ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ãŒè¡¨ç¤ºã•ã‚Œãªã„ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€Œåå¿œãŒãªã„ã€ã¨æ„Ÿã˜ã‚‹

3. **ãƒ•ãƒ«ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰**
   - `window.location.href` ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ç®‡æ‰€ãŒã‚ã‚Šã€ãƒ•ãƒ«ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ãŒç™ºç”Ÿ
   - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®æ©æµã‚’å—ã‘ã‚‰ã‚Œãªã„

---

## ğŸ¯ æ”¹å–„ç›®æ¨™

1. **å³åº§ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: ã‚¯ãƒªãƒƒã‚¯ã—ãŸãƒšãƒ¼ã‚¸ã‚’å³åº§ã«ãƒã‚¤ãƒ©ã‚¤ãƒˆ
2. **å³åº§ã®ãƒšãƒ¼ã‚¸é·ç§»**: ã‚¯ãƒªãƒƒã‚¯ã¨åŒæ™‚ã«ãƒšãƒ¼ã‚¸é·ç§»ã‚’é–‹å§‹
3. **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®è¡¨ç¤º**: ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­ã«ã‚¹ã‚±ãƒ«ãƒˆãƒ³UIã‚’è¡¨ç¤º
4. **ã‚¹ãƒ ãƒ¼ã‚ºãªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ´»ç”¨

---

## ğŸ” ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³

### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

#### 1. ãƒšãƒ¼ã‚¸ä¸€è¦§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `components/notes/PagesList/PagesList.tsx`
- **å®Ÿè£…**: Next.js ã® `<Link>` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨
- **å•é¡Œ**: ã‚¯ãƒªãƒƒã‚¯æ™‚ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒãªã„

```91:94:components/notes/PagesList/PagesList.tsx
				<Link
					key={page.id}
					href={`/notes/${encodeURIComponent(slug)}/${encodeURIComponent(page.id)}`}
				>
```

#### 2. ãƒšãƒ¼ã‚¸è©³ç´°ãƒšãƒ¼ã‚¸
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `app/(protected)/notes/[slug]/[id]/page.tsx`
- **å®Ÿè£…**: ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãƒ‡ãƒ¼ã‚¿å–å¾—
- **å•é¡Œ**: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®è¡¨ç¤ºãŒãªã„ï¼ˆ`loading.tsx` ãŒå­˜åœ¨ã—ãªã„ï¼‰

#### 3. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/unilink/resolver/navigation.ts`
- **å®Ÿè£…**: `window.location.href` ã‚’ä½¿ç”¨
- **å•é¡Œ**: ãƒ•ãƒ«ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ãŒç™ºç”Ÿ

```36:58:lib/unilink/resolver/navigation.ts
export function navigateToPageWithContext(
	pageId: string,
	noteSlug?: string | null,
	isNewPage = false,
): void {
	try {
		if (typeof window !== "undefined") {
			const queryParam = isNewPage ? "?newPage=true" : "";

			const href = noteSlug
				? `/notes/${encodeURIComponent(noteSlug)}/${pageId}${queryParam}`
				: `/notes/default/${pageId}${queryParam}`;

			window.location.href = href;
		}
	} catch (error) {
		logger.error(
			{ pageId, noteSlug, isNewPage, error },
			"[UnifiedResolver] Navigation failed",
		);
		toast.error("ãƒšãƒ¼ã‚¸ã®è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ");
	}
}
```

---

## ğŸ’¡ æ”¹å–„æ¡ˆ

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ 1: æ®µéšçš„æ”¹å–„ï¼ˆæ¨å¥¨ï¼‰

#### Phase 1: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®è¿½åŠ 

1. **`loading.tsx` ã®ä½œæˆ**
   - `app/(protected)/notes/[slug]/[id]/loading.tsx` ã‚’ä½œæˆ
   - ãƒšãƒ¼ã‚¸è©³ç´°ã®ã‚¹ã‚±ãƒ«ãƒˆãƒ³UIã‚’è¡¨ç¤º

2. **è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®è¿½åŠ **
   - `PagesList.tsx` ã§ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’è¡¨ç¤º
   - ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚«ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ

#### Phase 2: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

1. **`PagesList.tsx` ã®æ”¹å–„**
   - `useRouter()` ã¨ `router.push()` ã‚’ä½¿ç”¨
   - `useTransition()` ã§ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’ç®¡ç†

2. **ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã®æ”¹å–„**
   - `navigateToPageWithContext()` ã‚’ `router.push()` ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´

#### Phase 3: ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒã®æ´»ç”¨

1. **ãƒªãƒ³ã‚¯ã®ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒ**
   - Next.js ã® `<Link>` ã® `prefetch` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æ´»ç”¨
   - ãƒ›ãƒãƒ¼æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’äº‹å‰å–å¾—

---

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ 2: ã‚ªãƒ—ãƒ†ã‚£ãƒŸã‚¹ãƒ†ã‚£ãƒƒã‚¯UIï¼ˆä¸Šç´šï¼‰

1. **å³åº§ã®ãƒšãƒ¼ã‚¸è¡¨ç¤º**
   - ãƒšãƒ¼ã‚¸ä¸€è¦§ã§æ—¢ã«å–å¾—æ¸ˆã¿ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã€ã‚µãƒ ãƒã‚¤ãƒ«ï¼‰ã‚’å³åº§ã«è¡¨ç¤º
   - è©³ç´°ãƒ‡ãƒ¼ã‚¿ã¯å¾Œã‹ã‚‰å–å¾—ã—ã¦æ›´æ–°

2. **ã‚¹ãƒ¯ã‚¤ãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**
   - ãƒ¢ãƒã‚¤ãƒ«ã§ã‚¹ãƒ¯ã‚¤ãƒ—ã§å‰å¾Œã®ãƒšãƒ¼ã‚¸ã«ç§»å‹•

---

## ğŸ“ å®Ÿè£…è©³ç´°

### 1. ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®è¿½åŠ 

#### `app/(protected)/notes/[slug]/[id]/loading.tsx`

```tsx
import { Container } from "@/components/layouts/container";
import { BackLink } from "@/components/ui/back-link";
import { Skeleton } from "@/components/ui/skeleton";
import { Card, CardContent, CardHeader } from "@/components/ui/card";

export default function PageDetailLoading() {
	return (
		<Container>
			<BackLink title="ãƒšãƒ¼ã‚¸ä¸€è¦§ã«æˆ»ã‚‹" path="#" />
			<Card className="mt-4">
				<CardHeader>
					<Skeleton className="h-8 w-64" />
				</CardHeader>
				<CardContent>
					<div className="space-y-4">
						<Skeleton className="h-4 w-full" />
						<Skeleton className="h-4 w-full" />
						<Skeleton className="h-4 w-3/4" />
					</div>
				</CardContent>
			</Card>
		</Container>
	);
}
```

### 2. PagesList ã®æ”¹å–„

#### `components/notes/PagesList/PagesList.tsx` ã®å¤‰æ›´

```tsx
"use client";

import { useRouter } from "next/navigation";
import { useTransition, useState } from "react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
// ... other imports

export function PagesList({
	pages,
	slug = "all-pages",
	gridCols = "grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6",
}: PagesListProps) {
	const router = useRouter();
	const [isPending, startTransition] = useTransition();
	const [clickedPageId, setClickedPageId] = useState<string | null>(null);

	const handlePageClick = (pageId: string) => {
		setClickedPageId(pageId);
		startTransition(() => {
			router.push(`/notes/${encodeURIComponent(slug)}/${encodeURIComponent(pageId)}`);
		});
	};

	// ... rest of component

	return (
		<div className={`grid gap-2 md:gap-4 ${gridCols}`}>
			{pages.map((page) => (
				<Card
					key={page.id}
					onClick={() => handlePageClick(page.id)}
					className={cn(
						"h-full overflow-hidden transition-all hover:shadow-md py-4 gap-2 cursor-pointer",
						clickedPageId === page.id && "ring-2 ring-primary",
						isPending && clickedPageId === page.id && "opacity-50"
					)}
				>
					{/* ... card content */}
				</Card>
			))}
		</div>
	);
}
```

### 3. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã®æ”¹å–„

#### `lib/unilink/resolver/navigation.ts` ã®å¤‰æ›´

```tsx
import { useRouter } from "next/navigation";

// Client-side navigation hook
export function useNavigateToPage() {
	const router = useRouter();
	
	return (pageId: string, noteSlug?: string | null, isNewPage = false) => {
		const queryParam = isNewPage ? "?newPage=true" : "";
		const href = noteSlug
			? `/notes/${encodeURIComponent(noteSlug)}/${pageId}${queryParam}`
			: `/notes/default/${pageId}${queryParam}`;
		
		router.push(href);
	};
}

// Server-side navigation (fallback)
export function navigateToPageWithContext(
	pageId: string,
	noteSlug?: string | null,
	isNewPage = false,
): void {
	// ... existing implementation for server-side use
}
```

---

## âœ… æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

1. **UXã®å‘ä¸Š**
   - ã‚¯ãƒªãƒƒã‚¯ã—ãŸãƒšãƒ¼ã‚¸ãŒå³åº§ã«ãƒã‚¤ãƒ©ã‚¤ãƒˆã•ã‚Œã‚‹
   - ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ãŒæ˜ç¢ºã«è¡¨ç¤ºã•ã‚Œã‚‹
   - ã‚¹ãƒ ãƒ¼ã‚ºãªãƒšãƒ¼ã‚¸é·ç§»

2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸Š**
   - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹é«˜é€ŸåŒ–
   - ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒã«ã‚ˆã‚‹äº‹å‰ãƒ‡ãƒ¼ã‚¿å–å¾—

3. **ãƒ¢ãƒã‚¤ãƒ«ä½“é¨“ã®æ”¹å–„**
   - ã‚¿ãƒƒãƒ—æ™‚ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒæ˜ç¢º
   - ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ãŒåˆ†ã‹ã‚Šã‚„ã™ã„

---

## ğŸ”— é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `components/notes/PagesList/PagesList.tsx` - ãƒšãƒ¼ã‚¸ä¸€è¦§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `app/(protected)/notes/[slug]/[id]/page.tsx` - ãƒšãƒ¼ã‚¸è©³ç´°ãƒšãƒ¼ã‚¸
- `lib/unilink/resolver/navigation.ts` - ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
- `lib/tiptap-extensions/unified-link-mark/plugins/click-handler-plugin.ts` - ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼

---

## ğŸ“Œ å®Ÿè£…å„ªå…ˆåº¦

1. **Phase 1ï¼ˆé«˜å„ªå…ˆåº¦ï¼‰**: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®è¿½åŠ 
2. **Phase 2ï¼ˆä¸­å„ªå…ˆåº¦ï¼‰**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
3. **Phase 3ï¼ˆä½å„ªå…ˆåº¦ï¼‰**: ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒã®æœ€é©åŒ–

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆé …ç›®

- [ ] ãƒšãƒ¼ã‚¸ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸéš›ã«å³åº§ã«ãƒã‚¤ãƒ©ã‚¤ãƒˆã•ã‚Œã‚‹
- [ ] ãƒšãƒ¼ã‚¸é·ç§»ä¸­ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿å–å¾—å®Œäº†å¾Œã«ãƒšãƒ¼ã‚¸ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã§ã‚¿ãƒƒãƒ—æ™‚ã®åå¿œãŒæ˜ç¢º
- [ ] ã‚¨ãƒ©ãƒ¼æ™‚ã®é©åˆ‡ãªå‡¦ç†

