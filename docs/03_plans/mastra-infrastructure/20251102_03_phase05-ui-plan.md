# Phase 0.5: UIå®Ÿè£…è¨ˆç”»

**ä½œæˆæ—¥:** 2025-11-02
**å¯¾è±¡:** APIã‚­ãƒ¼ç®¡ç†UI
**å‰ææ¡ä»¶:** Phase 0.4ï¼ˆServer Actionsï¼‰å®Œäº†

---

## æ¦‚è¦

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒLLM APIã‚­ãƒ¼ã‚’è¨­å®šãƒ»ç®¡ç†ã§ãã‚‹UIã‚’å®Ÿè£…ã—ã¾ã™ã€‚
ç›´æ„Ÿçš„ã§ä½¿ã„ã‚„ã™ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã—ã€ã‚»ã‚­ãƒ¥ã‚¢ãªAPIã‚­ãƒ¼ç®¡ç†ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

---

## å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
app/(protected)/settings/api-keys/
â””â”€â”€ page.tsx                          # APIã‚­ãƒ¼è¨­å®šãƒšãƒ¼ã‚¸

components/settings/
â”œâ”€â”€ APIKeySettings.tsx                # ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ APIKeyForm.tsx                    # APIã‚­ãƒ¼å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
â”œâ”€â”€ ProviderCard.tsx                  # ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚«ãƒ¼ãƒ‰
â””â”€â”€ APIKeyStatusBadge.tsx             # è¨­å®šçŠ¶æ…‹ãƒãƒƒã‚¸

components/settings/__tests__/
â”œâ”€â”€ APIKeySettings.test.tsx
â”œâ”€â”€ APIKeyForm.test.tsx
â”œâ”€â”€ ProviderCard.test.tsx
â””â”€â”€ APIKeyStatusBadge.test.tsx

components/settings/
â”œâ”€â”€ APIKeySettings.spec.md
â”œâ”€â”€ APIKeyForm.spec.md
â”œâ”€â”€ ProviderCard.spec.md
â””â”€â”€ APIKeyStatusBadge.spec.md
```

---

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼

### ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼

```
1. /settings/api-keys ã«ã‚¢ã‚¯ã‚»ã‚¹
   â†“
2. 3ã¤ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚«ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - Google Gemini
   - OpenAI
   - Anthropic Claude
   â†“
3. ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯
   â†“
4. APIã‚­ãƒ¼å…¥åŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‹ã
   â†“
5. APIã‚­ãƒ¼ã‚’å…¥åŠ›
   â†“
6. [ãƒ†ã‚¹ãƒˆ] ãƒœã‚¿ãƒ³ã§ã‚­ãƒ¼æ¤œè¨¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   â†“
7. [ä¿å­˜] ãƒœã‚¿ãƒ³ã§ä¿å­˜
   â†“
8. æˆåŠŸãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º + ã‚«ãƒ¼ãƒ‰ã®çŠ¶æ…‹æ›´æ–°
```

### ã‚µãƒ–ãƒ•ãƒ­ãƒ¼

**å‰Šé™¤:**
```
1. è¨­å®šæ¸ˆã¿ã‚«ãƒ¼ãƒ‰ã® [å‰Šé™¤] ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   â†“
2. ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
   â†“
3. [å‰Šé™¤] ç¢ºå®š
   â†“
4. APIã‚­ãƒ¼å‰Šé™¤ + ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
```

**æ›´æ–°:**
```
1. è¨­å®šæ¸ˆã¿ã‚«ãƒ¼ãƒ‰ã® [ç·¨é›†] ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   â†“
2. APIã‚­ãƒ¼å…¥åŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‹ãï¼ˆæ—¢å­˜ã‚­ãƒ¼ã¯è¡¨ç¤ºã—ãªã„ï¼‰
   â†“
3. æ–°ã—ã„APIã‚­ãƒ¼ã‚’å…¥åŠ›
   â†“
4. [ä¿å­˜] ã§ä¸Šæ›¸ãä¿å­˜
```

---

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä»•æ§˜

### 1. page.tsxï¼ˆè¨­å®šãƒšãƒ¼ã‚¸ï¼‰

**å ´æ‰€:** `app/(protected)/settings/api-keys/page.tsx`

**å½¹å‰²:**
- èªè¨¼ç¢ºèª
- APIKeySettingsã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ©ãƒƒãƒ‘ãƒ¼
- ãƒšãƒ¼ã‚¸ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¨­å®š

**å®Ÿè£…:**
```typescript
export default async function APIKeysPage() {
  // èªè¨¼ç¢ºèªï¼ˆmiddleware ã§å®Ÿæ–½æ¸ˆã¿ã ãŒå¿µã®ãŸã‚ï¼‰
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();
  
  if (!user) {
    redirect('/auth/login');
  }
  
  return (
    <div className="container max-w-4xl py-8">
      <h1 className="text-3xl font-bold mb-2">API ã‚­ãƒ¼è¨­å®š</h1>
      <p className="text-muted-foreground mb-8">
        å„LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„
      </p>
      <APIKeySettings />
    </div>
  );
}
```

---

### 2. APIKeySettings.tsxï¼ˆãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰

**å½¹å‰²:**
- å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç®¡ç†
- APIã‚­ãƒ¼çŠ¶æ…‹ã®å–å¾—ãƒ»ç®¡ç†
- 3ã¤ã®ProviderCardã‚’è¡¨ç¤º

**çŠ¶æ…‹ç®¡ç†:**
```typescript
const [keyStatus, setKeyStatus] = useState<APIKeyStatusMap | null>(null);
const [isLoading, setIsLoading] = useState(true);
const [selectedProvider, setSelectedProvider] = useState<LLMProvider | null>(null);
const [isDialogOpen, setIsDialogOpen] = useState(false);
```

**ä¸»è¦æ©Ÿèƒ½:**
- `useEffect` ã§åˆå›ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—
- ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ â†’ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
- ä¿å­˜æˆåŠŸå¾Œ â†’ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å†å–å¾—

---

### 3. ProviderCard.tsxï¼ˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚«ãƒ¼ãƒ‰ï¼‰

**å½¹å‰²:**
- å„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®æƒ…å ±è¡¨ç¤º
- è¨­å®šçŠ¶æ…‹ã®è¦–è¦šåŒ–
- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè¨­å®š/ç·¨é›†/å‰Šé™¤ï¼‰ãƒœã‚¿ãƒ³

**ãƒ—ãƒ­ãƒƒãƒ—ã‚¹:**
```typescript
interface ProviderCardProps {
  provider: LLMProvider;
  configured: boolean;
  updatedAt: string | null;
  onConfigure: () => void;
  onDelete: () => void;
}
```

**è¡¨ç¤ºå†…å®¹:**
- ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ­ã‚´/ã‚¢ã‚¤ã‚³ãƒ³
- ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å
- èª¬æ˜æ–‡
- è¨­å®šçŠ¶æ…‹ãƒãƒƒã‚¸
- æœ€çµ‚æ›´æ–°æ—¥æ™‚
- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³

**ãƒ‡ã‚¶ã‚¤ãƒ³:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– Google Gemini      [âœ“ è¨­å®šæ¸ˆã¿] â”‚
â”‚                                    â”‚
â”‚ Googleã®æœ€æ–°LLMãƒ¢ãƒ‡ãƒ«               â”‚
â”‚ gemini-2.0-flash-exp               â”‚
â”‚                                    â”‚
â”‚ æœ€çµ‚æ›´æ–°: 2025-11-02 10:00         â”‚
â”‚                                    â”‚
â”‚ [ç·¨é›†]  [å‰Šé™¤]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. APIKeyForm.tsxï¼ˆAPIã‚­ãƒ¼å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ï¼‰

**å½¹å‰²:**
- APIã‚­ãƒ¼å…¥åŠ›
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼
- ä¿å­˜å‡¦ç†

**ãƒ—ãƒ­ãƒƒãƒ—ã‚¹:**
```typescript
interface APIKeyFormProps {
  provider: LLMProvider;
  isOpen: boolean;
  onClose: () => void;
  onSave: () => void;
}
```

**çŠ¶æ…‹:**
```typescript
const [apiKey, setApiKey] = useState("");
const [isVisible, setIsVisible] = useState(false);
const [isTesting, setIsTesting] = useState(false);
const [isSaving, setIsSaving] = useState(false);
const [testResult, setTestResult] = useState<"success" | "error" | null>(null);
```

**æ©Ÿèƒ½:**
- APIã‚­ãƒ¼å…¥åŠ›ï¼ˆtype="password" / "text" åˆ‡ã‚Šæ›¿ãˆï¼‰
- [ğŸ‘ï¸ è¡¨ç¤º/éè¡¨ç¤º] ãƒœã‚¿ãƒ³
- [ãƒ†ã‚¹ãƒˆ] ãƒœã‚¿ãƒ³ â†’ testAPIKey() å®Ÿè¡Œ
- [ä¿å­˜] ãƒœã‚¿ãƒ³ â†’ saveAPIKey() å®Ÿè¡Œ
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯ï¼‰

**ãƒ‡ã‚¶ã‚¤ãƒ³:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Google Gemini APIã‚­ãƒ¼è¨­å®š           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ APIã‚­ãƒ¼                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” [ğŸ‘ï¸]  â”‚
â”‚ â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â”‚        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                     â”‚
â”‚ â“˜ APIã‚­ãƒ¼ã¯https://... ã§å–å¾—      â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ãƒ†ã‚¹ãƒˆ  â”‚  â”‚ ä¿å­˜ â”‚  â”‚ ã‚­ãƒ£ãƒ³ã‚»ãƒ« â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 5. APIKeyStatusBadge.tsxï¼ˆè¨­å®šçŠ¶æ…‹ãƒãƒƒã‚¸ï¼‰

**å½¹å‰²:**
- è¨­å®šçŠ¶æ…‹ã®è¦–è¦šåŒ–

**ãƒ—ãƒ­ãƒƒãƒ—ã‚¹:**
```typescript
interface APIKeyStatusBadgeProps {
  configured: boolean;
}
```

**è¡¨ç¤º:**
```typescript
// è¨­å®šæ¸ˆã¿
<Badge variant="success">âœ“ è¨­å®šæ¸ˆã¿</Badge>

// æœªè¨­å®š
<Badge variant="secondary">æœªè¨­å®š</Badge>
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### åˆå›ãƒ­ãƒ¼ãƒ‰

```
page.tsx
  â†“
APIKeySettings
  â†“ useEffect
getAPIKeyStatus()  â† Server Action
  â†“
keyStatus æ›´æ–°
  â†“
ProviderCard Ã— 3 ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
```

---

### APIã‚­ãƒ¼ä¿å­˜

```
ProviderCard [è¨­å®š] ã‚¯ãƒªãƒƒã‚¯
  â†“
APIKeySettings: setSelectedProvider()
  â†“
APIKeyForm ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
  â†“
ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›
  â†“
[ä¿å­˜] ã‚¯ãƒªãƒƒã‚¯
  â†“
saveAPIKey()  â† Server Action
  â†“
æˆåŠŸæ™‚:
  - ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
  - getAPIKeyStatus() å†å®Ÿè¡Œ
  - ãƒ€ã‚¤ã‚¢ãƒ­ã‚°é–‰ã˜ã‚‹
  â†“
å¤±æ•—æ™‚:
  - ã‚¨ãƒ©ãƒ¼ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
  - ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã¯é–‹ã„ãŸã¾ã¾
```

---

### APIã‚­ãƒ¼å‰Šé™¤

```
ProviderCard [å‰Šé™¤] ã‚¯ãƒªãƒƒã‚¯
  â†“
ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
  â†“
[å‰Šé™¤] ç¢ºå®š
  â†“
deleteAPIKey()  â† Server Action
  â†“
æˆåŠŸæ™‚:
  - ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
  - getAPIKeyStatus() å†å®Ÿè¡Œ
  â†“
å¤±æ•—æ™‚:
  - ã‚¨ãƒ©ãƒ¼ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
```

---

## UI/UXã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ãƒ‡ã‚¶ã‚¤ãƒ³åŸå‰‡

1. **ã‚·ãƒ³ãƒ—ãƒ« & ç›´æ„Ÿçš„**
   - æœ€å°é™ã®ã‚¹ãƒ†ãƒƒãƒ—ã§è¨­å®šå®Œäº†
   - æ˜ç¢ºãªCTAï¼ˆCall To Actionï¼‰

2. **ã‚»ã‚­ãƒ¥ã‚¢ & é€æ˜**
   - APIã‚­ãƒ¼ã¯éè¡¨ç¤ºãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
   - è¡¨ç¤º/éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆå¯èƒ½
   - å‰Šé™¤æ™‚ã¯ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°

3. **ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é‡è¦–**
   - ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®è¡¨ç¤º
   - æˆåŠŸ/å¤±æ•—ã®ãƒˆãƒ¼ã‚¹ãƒˆ
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼çµæœ

---

### ã‚«ãƒ©ãƒ¼ãƒ»ã‚¢ã‚¤ã‚³ãƒ³

**ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼åˆ¥:**
```typescript
const providerConfig = {
  google: {
    name: "Google Gemini",
    icon: "ğŸ¤–",
    color: "blue",
    description: "Googleã®æœ€æ–°LLMãƒ¢ãƒ‡ãƒ«",
    docsUrl: "https://ai.google.dev/",
  },
  openai: {
    name: "OpenAI",
    icon: "ğŸ¨",
    color: "green",
    description: "GPT-4oç­‰ã®å¼·åŠ›ãªãƒ¢ãƒ‡ãƒ«",
    docsUrl: "https://platform.openai.com/",
  },
  anthropic: {
    name: "Anthropic Claude",
    icon: "ğŸ§ ",
    color: "purple",
    description: "Claude 3.5 Sonnetç­‰",
    docsUrl: "https://docs.anthropic.com/",
  },
};
```

**çŠ¶æ…‹åˆ¥:**
- è¨­å®šæ¸ˆã¿: `badge-success` (ç·‘)
- æœªè¨­å®š: `badge-secondary` (ã‚°ãƒ¬ãƒ¼)
- ã‚¨ãƒ©ãƒ¼: `badge-destructive` (èµ¤)
- ãƒ†ã‚¹ãƒˆä¸­: `badge-warning` (é»„è‰²)

---

### ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£

1. **ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**
   - Tab ã§ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç§»å‹•
   - Enter ã§ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
   - Esc ã§ãƒ€ã‚¤ã‚¢ãƒ­ã‚°é–‰ã˜ã‚‹

2. **ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ**
   - é©åˆ‡ãª aria-label
   - role å±æ€§ã®è¨­å®š
   - ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†

3. **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**
   - å…·ä½“çš„ã§å®Ÿè¡Œå¯èƒ½
   - èµ¤è‰² + ã‚¢ã‚¤ã‚³ãƒ³ã§è¦–è¦šåŒ–

---

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´

```typescript
// APIã‚­ãƒ¼å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
if (!apiKey.trim()) {
  toast.error("APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
  return;
}

// ãƒ†ã‚¹ãƒˆå¤±æ•—
if (!testResult.success) {
  toast.error(testResult.error);
  setTestResult("error");
}

// ä¿å­˜å¤±æ•—
if (!saveResult.success) {
  toast.error(saveResult.error);
}
```

### ã‚µãƒ¼ãƒãƒ¼å´

Server Actionsï¼ˆPhase 0.4ã§å®Ÿè£…æ¸ˆã¿ï¼‰:
- æœªèªè¨¼ â†’ "ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™"
- ç„¡åŠ¹ãªãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ â†’ "ç„¡åŠ¹ãªãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã§ã™"
- ç©ºã®APIã‚­ãƒ¼ â†’ "APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ â†’ "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"

---

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

```typescript
describe("ProviderCard", () => {
  test("è¨­å®šæ¸ˆã¿ã®å ´åˆã€ç·¨é›†ãƒ»å‰Šé™¤ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹", () => {
    render(
      <ProviderCard 
        provider="google" 
        configured={true}
        updatedAt="2025-11-02T10:00:00Z"
        onConfigure={jest.fn()}
        onDelete={jest.fn()}
      />
    );
    
    expect(screen.getByText("ç·¨é›†")).toBeInTheDocument();
    expect(screen.getByText("å‰Šé™¤")).toBeInTheDocument();
  });
  
  test("æœªè¨­å®šã®å ´åˆã€è¨­å®šãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹", () => {
    render(
      <ProviderCard 
        provider="google" 
        configured={false}
        updatedAt={null}
        onConfigure={jest.fn()}
        onDelete={jest.fn()}
      />
    );
    
    expect(screen.getByText("è¨­å®š")).toBeInTheDocument();
  });
});

describe("APIKeyForm", () => {
  test("ç©ºã®APIã‚­ãƒ¼ã§ã¯ä¿å­˜ã§ããªã„", () => {
    render(<APIKeyForm provider="google" isOpen={true} onClose={jest.fn()} onSave={jest.fn()} />);
    
    fireEvent.click(screen.getByText("ä¿å­˜"));
    
    expect(screen.getByText("APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")).toBeInTheDocument();
  });
  
  test("ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨testAPIKeyãŒå‘¼ã°ã‚Œã‚‹", async () => {
    const mockTest = jest.fn();
    render(<APIKeyForm provider="google" isOpen={true} onClose={jest.fn()} onSave={jest.fn()} />);
    
    fireEvent.change(screen.getByLabelText("APIã‚­ãƒ¼"), { target: { value: "test-key" } });
    fireEvent.click(screen.getByText("ãƒ†ã‚¹ãƒˆ"));
    
    await waitFor(() => {
      expect(mockTest).toHaveBeenCalledWith("google", "test-key");
    });
  });
});
```

---

### E2Eãƒ†ã‚¹ãƒˆï¼ˆPlaywrightï¼‰

```typescript
test("APIã‚­ãƒ¼è¨­å®šãƒ•ãƒ­ãƒ¼", async ({ page }) => {
  // 1. ãƒ­ã‚°ã‚¤ãƒ³
  await page.goto("/auth/login");
  await page.fill('[data-testid="email"]', "test@example.com");
  await page.fill('[data-testid="password"]', "password");
  await page.click('[data-testid="submit"]');
  
  // 2. è¨­å®šãƒšãƒ¼ã‚¸ã¸ç§»å‹•
  await page.goto("/settings/api-keys");
  await page.waitForSelector('[data-testid="provider-card-google"]');
  
  // 3. Google ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯
  await page.click('[data-testid="provider-card-google"]');
  
  // 4. APIã‚­ãƒ¼å…¥åŠ›
  await page.fill('[data-testid="api-key-input"]', "test-google-api-key");
  
  // 5. ä¿å­˜
  await page.click('[data-testid="save-button"]');
  
  // 6. æˆåŠŸãƒˆãƒ¼ã‚¹ãƒˆç¢ºèª
  await page.waitForSelector('[data-testid="toast-success"]');
  
  // 7. ã‚«ãƒ¼ãƒ‰ã®çŠ¶æ…‹ç¢ºèª
  await expect(page.locator('[data-testid="badge-google"]')).toHaveText("âœ“ è¨­å®šæ¸ˆã¿");
});
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹

```typescript
// Suspense ã§åˆå›ãƒ­ãƒ¼ãƒ‰æœ€é©åŒ–
<Suspense fallback={<LoadingSkeleton />}>
  <APIKeySettings />
</Suspense>

// Skeletonè¡¨ç¤º
function LoadingSkeleton() {
  return (
    <div className="grid gap-4 md:grid-cols-3">
      {[1, 2, 3].map((i) => (
        <Skeleton key={i} className="h-48 w-full" />
      ))}
    </div>
  );
}
```

### 2. ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°

```typescript
// Server Component ã§åˆå›ãƒ‡ãƒ¼ã‚¿å–å¾—
async function APIKeysPage() {
  const initialStatus = await getAPIKeyStatus();
  
  return <APIKeySettings initialStatus={initialStatus} />;
}

// Client Component ã§ã¯ initialStatus ã‚’ä½¿ç”¨
function APIKeySettings({ initialStatus }) {
  const [status, setStatus] = useState(initialStatus);
  // ...
}
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 1. APIã‚­ãƒ¼ã®æ‰±ã„

```typescript
// âŒ Bad: ãƒ­ã‚°ã«å‡ºåŠ›
console.log("API Key:", apiKey);

// âœ… Good: ãƒ­ã‚°ã«ã¯å‡ºåŠ›ã—ãªã„
logger.debug("Saving API key for provider", { provider });

// âŒ Bad: URLã«å«ã‚ã‚‹
fetch(`/api/save-key?key=${apiKey}`);

// âœ… Good: POSTãƒœãƒ‡ã‚£ã§é€ä¿¡
fetch("/api/save-key", {
  method: "POST",
  body: JSON.stringify({ apiKey }),
});
```

### 2. XSSå¯¾ç­–

```typescript
// React ãŒè‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã™ã‚‹ãŒå¿µã®ãŸã‚ç¢ºèª
<p>{userInput}</p>  // âœ… å®‰å…¨

// dangerouslySetInnerHTML ã¯ä½¿ç”¨ã—ãªã„
<div dangerouslySetInnerHTML={{ __html: userInput }} />  // âŒ å±é™º
```

---

## å®Ÿè£…é †åº

### Day 1ï¼ˆ2025-11-03ï¼‰

1. **åˆå‰: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ**
   - [x] ProviderCard.spec.md
   - [ ] ProviderCard.tsx
   - [ ] ProviderCard.test.tsx
   - [x] APIKeyStatusBadge.spec.md
   - [ ] APIKeyStatusBadge.tsx

2. **åˆå¾Œ: ãƒ•ã‚©ãƒ¼ãƒ å®Ÿè£…**
   - [x] APIKeyForm.spec.md
   - [ ] APIKeyForm.tsx
   - [ ] APIKeyForm.test.tsx
   - [ ] APIKeySettings.tsx
   - [ ] page.tsx

3. **å¤•æ–¹: çµ±åˆãƒ»ãƒ†ã‚¹ãƒˆ**
   - [ ] å…¨ä½“å‹•ä½œç¢ºèª
   - [ ] E2Eãƒ†ã‚¹ãƒˆå®Ÿè£…
   - [ ] ä½œæ¥­ãƒ­ã‚°ä½œæˆ

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **Issue**: [#74 MastraåŸºç›¤æ§‹ç¯‰ã¨APIã‚­ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…](https://github.com/otomatty/for-all-learners/issues/74)
- **Phase 0.1**: Database Migration
- **Phase 0.2**: API Key Encryption
- **Phase 0.3**: Multi-LLM Client
- **Phase 0.4**: Server Actions
- **Phase 0.5**: UI Implementationï¼ˆã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰

---

**æœ€çµ‚æ›´æ–°:** 2025-11-02
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** è¨ˆç”»ä¸­
**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:** ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä»•æ§˜æ›¸ä½œæˆ â†’ å®Ÿè£…
