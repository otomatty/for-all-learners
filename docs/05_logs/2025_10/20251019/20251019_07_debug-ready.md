# ã‚¿ã‚°å…¥åŠ›é‡è¤‡å•é¡Œã®ãƒ‡ãƒãƒƒã‚°æº–å‚™å®Œäº†

**ä½œæˆæ—¥**: 2025-10-19  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”§ ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰è¿½åŠ å®Œäº†ã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­

---

## âœ… å®Œäº†ã—ãŸæº–å‚™

### 1. ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰è¿½åŠ 

ä»¥ä¸‹ã® 2 ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼š

#### `lib/tiptap-extensions/unified-link-mark/plugins/suggestion-plugin.ts`

```typescript
// ãƒ‡ãƒãƒƒã‚°ãƒ•ãƒ©ã‚°ï¼ˆ1è¡Œç›®ä»˜è¿‘ï¼‰
const DEBUG_TAG_DUPLICATION = true;

// ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°é–¢æ•°ï¼ˆè¿½åŠ æ¸ˆã¿ï¼‰
function debugLog(context, message, data?) { ... }

// è¿½åŠ ã•ã‚ŒãŸãƒ­ã‚°å‡ºåŠ›
- [KeyHandler] Enter/Tab/Space ã‚­ãƒ¼å‡¦ç†
- [insertUnifiedLinkWithQuery] ãƒªãƒ³ã‚¯æŒ¿å…¥å‡¦ç†
- [insertUnifiedLinkWithSpaceKey] ã‚¹ãƒšãƒ¼ã‚¹å‡¦ç†
```

#### `lib/tiptap-extensions/unified-link-mark/input-rules/tag-rule.ts`

```typescript
// ãƒ‡ãƒãƒƒã‚°ãƒ•ãƒ©ã‚°ï¼ˆå…ˆé ­ï¼‰
const DEBUG_TAG_DUPLICATION = true;

// ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°é–¢æ•°ï¼ˆè¿½åŠ æ¸ˆã¿ï¼‰
function debugLog(context, message, data?) { ... }

// è¿½åŠ ã•ã‚ŒãŸãƒ­ã‚°å‡ºåŠ›
- [handler] TagInputRule ãŒå®Ÿè¡Œã•ã‚Œã‚‹å…¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°
- [handler] ãƒãƒƒãƒã—ãŸå†…å®¹
- [handler] ãƒã‚§ãƒ¼ãƒ³æ“ä½œã®å®Ÿè¡ŒçŠ¶æ³
```

---

## ğŸš€ ã“ã‚Œã‹ã‚‰ã®ãƒ†ã‚¹ãƒˆæ‰‹é †

### æœ€é€Ÿã§ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰

```bash
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡Œ
cd /Users/sugaiakimasa/apps/for-all-learners
bun dev
```

ãã®å¾Œã€`http://localhost:3000` ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã€ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã‚’è¦‹ãªãŒã‚‰ã‚¨ãƒ‡ã‚£ã‚¿ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œï¼š

### ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³

**ãƒ†ã‚¹ãƒˆ 1: Enter ã‚­ãƒ¼**
```
1. ã‚¨ãƒ‡ã‚£ã‚¿ã« " #ãƒ†ã‚¹ãƒˆ" ã¨å…¥åŠ›ï¼ˆã‚¹ãƒšãƒ¼ã‚¹å¿…é ˆï¼‰
2. Enter ã‚­ãƒ¼ã‚’æŠ¼ã™
3. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ä»¥ä¸‹ã®ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª:
   - [KeyHandler] Enter key pressed
   - [insertUnifiedLinkWithQuery] Starting insertion
   - å•é¡ŒãŒãªã‘ã‚Œã° [TagRule] ã¯è¡¨ç¤ºã•ã‚Œãªã„
```

**ãƒ†ã‚¹ãƒˆ 2: Space ã‚­ãƒ¼**
```
1. æ–°ã—ã„æ®µè½ã‚’é–‹ã
2. " #ãƒ†ã‚¹ãƒˆ2" ã¨å…¥åŠ›
3. Space ã‚­ãƒ¼ã‚’æŠ¼ã™
4. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã‚’ç¢ºèª
```

---

## ğŸ“Š äºˆæƒ³ã•ã‚Œã‚‹çµæœã¨å•é¡Œè¨ºæ–­

### ã‚·ãƒŠãƒªã‚ª A: æ­£å¸¸ãªå ´åˆï¼ˆæœŸå¾…å€¤ï¼‰

```
[16:45:23.100] [UnifiedLinkMark] [KeyHandler] Enter key pressed | {...}
[16:45:23.101] [UnifiedLinkMark] [KeyHandler] Clearing suggestion state immediately
[16:45:23.102] [UnifiedLinkMark] [KeyHandler] Creating link with input text | {"query":"ãƒ†ã‚¹ãƒˆ"}
[16:45:23.103] [UnifiedLinkMark] [insertUnifiedLinkWithQuery] Starting insertion | {...}
[16:45:23.104] [UnifiedLinkMark] [insertUnifiedLinkWithQuery] Inserting text with mark | {...}
[16:45:23.105] [UnifiedLinkMark] [insertUnifiedLinkWithQuery] Dispatching transaction

âœ… ã‚¨ãƒ‡ã‚£ã‚¿: #ãƒ†ã‚¹ãƒˆï¼ˆ# ã¯ 1 å€‹ï¼‰
```

### ã‚·ãƒŠãƒªã‚ª B: äºŒé‡å®Ÿè¡Œã®å•é¡Œï¼ˆç¾åœ¨ã®ç—‡çŠ¶ï¼‰

```
[16:45:23.100] [UnifiedLinkMark] [KeyHandler] Enter key pressed | {...}
[16:45:23.101] [UnifiedLinkMark] [KeyHandler] Clearing suggestion state immediately
[16:45:23.102] [UnifiedLinkMark] [insertUnifiedLinkWithQuery] Starting insertion | {...}
[16:45:23.104] [UnifiedLinkMark] [insertUnifiedLinkWithQuery] Dispatching transaction
[16:45:23.105] [TagRule] [handler] Tag InputRule triggered | {
  "match":" #ãƒ†ã‚¹ãƒˆ",
  "raw":"ãƒ†ã‚¹ãƒˆ"
}
[16:45:23.106] [TagRule] [handler] Processing tag | {...}

âŒ ã‚¨ãƒ‡ã‚£ã‚¿: ##ãƒ†ã‚¹ãƒˆï¼ˆ# ã¯ 2 å€‹ï¼‰
```

### ã‚·ãƒŠãƒªã‚ª C: ä»–ã®äºˆæœŸã—ãªã„å‹•ä½œ

ãã®å ´åˆã¯ã€ãƒ­ã‚°å…¨ä½“ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä»¥ä¸‹ã«ã¾ã¨ã‚ã¦ãã ã•ã„:

```markdown
## ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›å…¨æ–‡

[paste here]

## è¦³æ¸¬ã•ã‚ŒãŸç—‡çŠ¶

[describe what you see]

## ã‚¨ãƒ‡ã‚£ã‚¿ã®è¡¨ç¤º

[before/after ã®çŠ¶æ…‹ã‚’è¨˜è¿°]
```

---

## ğŸ“ ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œã«ã‚„ã‚‹ã“ã¨ãƒªã‚¹ãƒˆ

1. **ãƒ­ã‚°è§£æ** â†’ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã‹ã‚‰åŸå› ã‚’ç‰¹å®š
2. **ä¿®æ­£å®Ÿè£…** â†’ åŸå› ã«å¿œã˜ã¦ comment/æ¡ä»¶åˆ†å²ãªã©ã‚’ä¿®æ­£
3. **ãƒ†ã‚¹ãƒˆè¿½åŠ ** â†’ é‡è¤‡ã‚’é˜²ããƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ 
4. **å†ãƒ†ã‚¹ãƒˆ** â†’ ãƒ–ãƒ©ã‚¦ã‚¶ã§å†ç¢ºèª
5. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°** â†’ ä¿®æ­£å†…å®¹ã¨çµæœã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–

---

## ğŸ’¡ ãƒ‡ãƒãƒƒã‚°ã®ã‚³ãƒ„

- **ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: ã€ŒUnifiedLinkMarkã€ã§æ¤œç´¢ã™ã‚‹ã¨ã€é–¢é€£ãƒ­ã‚°ã ã‘ã‚’è¡¨ç¤ºã§ãã¾ã™
- **ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã§å‡¦ç†é †åºã‚’æŠŠæ¡**: ãƒ­ã‚°ã®æ™‚åˆ»ã‹ã‚‰å‡¦ç†ãŒã©ã‚“ãªé †åºã§å®Ÿè¡Œã•ã‚ŒãŸã‹ç¢ºèªã§ãã¾ã™
- **Data éƒ¨åˆ†ã‚’å±•é–‹**: ãƒ­ã‚°ã® JSON ãƒ‡ãƒ¼ã‚¿ã‚’é–‹ã„ã¦ã€å…·ä½“çš„ãªå€¤ã‚’ç¢ºèªã§ãã¾ã™
- **è¤‡æ•°å›å®Ÿè¡Œ**: 2 å›ã€3 å›å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ä¸€è²«æ€§ãŒã‚ã‚‹ã‹ç¢ºèªã§ãã¾ã™

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docs/issues/open/20251019_07_tag-duplication-on-enter-space-keys.md` - å•é¡Œã®è©³ç´°èª¬æ˜
- `docs/issues/open/20251019_07_debug-execution-guide.md` - ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œã‚¬ã‚¤ãƒ‰ï¼ˆè©³ç´°ç‰ˆï¼‰

---

**æº–å‚™çŠ¶æ…‹**: âœ… å®Œäº†  
**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆã§ãƒ­ã‚°ã‚’ç¢ºèª
