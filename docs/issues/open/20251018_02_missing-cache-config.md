# Next.js Dynamic Route ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°è¨­å®šã®æ¬ è½

## æ¦‚è¦

è¤‡æ•°ã®ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã€æ˜ç¤ºçš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°è¨­å®šï¼ˆ`export const dynamic` ã¾ãŸã¯ `export const revalidate`ï¼‰ãŒæ¬ è½ã—ã¦ãŠã‚Šã€Next.js ã®è‡ªå‹•åˆ¤å®šã«ä»»ã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚

## ç™ºè¦‹å ´æ‰€

`app/(protected)/` é…ä¸‹ã®ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ï¼š

```
/settings/page.tsx
/learn/page.tsx
/goals/page.tsx
/search/page.tsx
/decks/[deckId]/ocr/page.tsx
/decks/[deckId]/pdf/page.tsx
/decks/[deckId]/audio/page.tsx
/decks/[deckId]/page.tsx
/decks/page.tsx
/dashboard/page.tsx
/notes/explorer/page.tsx
/notes/page.tsx
/notes/[slug]/[id]/page.tsx
/notes/[slug]/page.tsx
/profile/page.tsx
/pages/[id]/generate-cards/page.tsx
/pages/page.tsx
```

## å•é¡Œã®è©³ç´°

### ä½•ãŒèµ·ãã¦ã„ã‚‹ã‹

**ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°è¨­å®šãŒãªã„ãƒšãƒ¼ã‚¸**ã§ã¯ã€Next.js ãŒä»¥ä¸‹ã®ãƒ­ã‚¸ãƒƒã‚¯ã§å‹•ä½œã—ã¾ã™ï¼š

```
1. ãƒšãƒ¼ã‚¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡
   â†“
2. Server Component ãŒå®Ÿè¡Œï¼ˆå…¨ã‚¯ã‚¨ãƒªå®Ÿè¡Œï¼‰
   â†“
3. ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°å¯èƒ½ã‹åˆ¤å®šï¼š
   - å‹•çš„ API ä½¿ç”¨ï¼ˆcookies, headersç­‰ï¼‰â†’ dynamic
   - æ˜ç¤ºè¨­å®šãªã— â†’ ä¸ç¢ºå®šçŠ¶æ…‹
   â†“
4. è‡ªå‹•åˆ¤å®šãŒä¸å®‰å®š â†’ dynamic/static ã‚’åˆ‡ã‚Šæ›¿ãˆ
   â†“
5. ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥ãŒã‚³ãƒ­ã‚³ãƒ­å¤‰ã‚ã‚‹
```

### å½±éŸ¿ç¯„å›²

- **ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿**: ä¸å®‰å®šã«ãªã‚‹å¯èƒ½æ€§
- **DevTools ãƒ‘ãƒãƒ«**: route status ãŒå¤‰ã‚ã‚‹
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°åŠ¹æœãŒä¸å®‰å®š
- **ãƒ‡ãƒãƒƒã‚°é›£åº¦**: åŸå› ãŒç‰¹å®šã—ã«ãã„

## æ¨å¥¨ã•ã‚Œã‚‹è§£æ±ºç­–

### å„ªå…ˆåº¦ï¼šé«˜

**å¸¸ã« dynamic ã§ã‚ã‚‹ã¹ããƒšãƒ¼ã‚¸** ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ãƒ‡ãƒ¼ã‚¿ï¼‰ï¼š

```
âŒ /dashboard/page.tsx - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
âŒ /profile/page.tsx - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
âŒ /pages/[id]/page.tsx - ãƒšãƒ¼ã‚¸ã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆæ—¢ã«ä¿®æ­£æ¸ˆï¼‰
```

ğŸ‘‰ `export const dynamic = "force-dynamic"` ã‚’è¿½åŠ 

### å„ªå…ˆåº¦ï¼šä¸­

**éƒ¨åˆ†çš„ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯èƒ½ãªãƒšãƒ¼ã‚¸** ï¼ˆå‚ç…§ãƒ‡ãƒ¼ã‚¿ãŒæ··åœ¨ï¼‰ï¼š

```
âš ï¸ /decks/[deckId]/page.tsx - ãƒ‡ãƒƒã‚­è©³ç´°
âš ï¸ /notes/[slug]/[id]/page.tsx - ãƒãƒ¼ãƒˆè©³ç´°
âš ï¸ /pages/page.tsx - ãƒšãƒ¼ã‚¸ãƒªã‚¹ãƒˆ
```

ğŸ‘‰ `export const revalidate = 3600` ãªã©ã€é©åˆ‡ãª revalidate æ™‚é–“ã‚’è¨­å®š

### å„ªå…ˆåº¦ï¼šä½

**ã»ã¼é™çš„ãªãƒšãƒ¼ã‚¸** ï¼ˆå‚ç…§ãƒ‡ãƒ¼ã‚¿ã®ã¿ï¼‰ï¼š

```
â„¹ï¸ /search/page.tsx - ã‚µãƒ¼ãƒçµæœï¼ˆæ¤œç´¢æ¡ä»¶ã«ä¾å­˜ï¼‰
â„¹ï¸ /goals/page.tsx - ã‚´ãƒ¼ãƒ«ç®¡ç†
```

ğŸ‘‰ `export const revalidate = 300` ãªã©çŸ­ã„ revalidate æ™‚é–“ã§ OK

## ãƒ†ã‚¹ãƒˆé …ç›®

- [ ] ä¿®æ­£å‰å¾Œã§ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿é€Ÿåº¦ã‚’æ¯”è¼ƒ
- [ ] DevTools ãƒ‘ãƒãƒ«ã§ route status ãŒå®‰å®šã—ã¦ã„ã‚‹ã‹ç¢ºèª
- [ ] Network ã‚¿ãƒ–ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ãŒå¢—ãˆã¦ã„ãªã„ã‹ç¢ºèª
- [ ] ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ãªã„ã‹

## å®Ÿè£…è¨ˆç”»

1. **æœ€åˆ**ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ãƒšãƒ¼ã‚¸ã‹ã‚‰ `dynamic = "force-dynamic"` ã‚’é©ç”¨
2. **ãã®æ¬¡**ï¼šå„ãƒšãƒ¼ã‚¸ã®å½¹å‰²ã‚’åˆ†æã—ã¦ã€é©åˆ‡ãª `revalidate` ã‚’è¨­å®š
3. **æœ€å¾Œ**ï¼šã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- ä¿®æ­£ä¾‹ï¼š`docs/08_worklogs/2025_10/20251018_39_dynamic-route-fix-validation.md`
- ç„¡é™ãƒ«ãƒ¼ãƒ—ä¿®æ­£ï¼š`docs/08_worklogs/2025_10/20251018_34_final-summary.md`

## é‡è¦åº¦

**High** - ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æŒ™å‹•ã®ä¸å®‰å®šã•ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨å¯è¦³æ¸¬æ€§ã«å¤§ããå½±éŸ¿

## ä½œæˆæ—¥

2025-10-18
