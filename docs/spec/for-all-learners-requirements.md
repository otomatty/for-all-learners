# for-all-learners 要件定義書

## 概要

**プロジェクト名**: for-all-learners  
**作成日**: 2025-08-03  
**技術スタック**: Next.js 15 + React 19 + TypeScript + Supabase  
**要件範囲**: 学習支援プラットフォームの包括的機能要件

for-all-learnersは、フラッシュカード学習、ノート管理、AI支援機能を統合した包括的な学習支援プラットフォームです。間隔反復学習アルゴリズム、リッチテキストエディタ、外部サービス統合により、効率的な学習体験を提供します。

## ユーザストーリー

### ストーリー1: フラッシュカード学習システム

- **である** 学習者 **として**
- **私は** 効率的な記憶定着のためのフラッシュカード学習 **をしたい**
- **そうすることで** 科学的根拠に基づく間隔反復により長期記憶を形成できる

### ストーリー2: インテリジェントノート管理

- **である** 知識管理を行う学習者 **として**
- **私は** ページ間リンクとリッチテキストを使ったノート管理 **をしたい**
- **そうすることで** 構造化された知識ベースを構築し学習効率を向上させる

### ストーリー3: AI支援学習コンテンツ生成

- **である** 効率的に学習教材を作成したい学習者 **として**
- **私は** AIによる自動フラッシュカード生成と音声・画像からのテキスト抽出 **をしたい**
- **そうすることで** 教材作成時間を短縮し学習に集中できる

### ストーリー4: 学習進捗管理とゴール設定

- **である** 継続的な学習を行いたい学習者 **として**
- **私は** 学習目標の設定と進捗の可視化 **をしたい**
- **そうすることで** モチベーションを維持し計画的な学習を実現する

### ストーリー5: コラボレーション機能

- **である** チームや友人と学習したい学習者 **として**
- **私は** デッキやページの共有と協同編集 **をしたい**
- **そうすることで** 集合知を活用し学習効果を高める

## 機能要件（EARS記法）

### 認証・ユーザー管理要件

- REQ-001: システムはSupabase Authを使用したGoogle OAuth認証を提供しなければならない
- REQ-002: システムはマジックリンクによるパスワードレス認証を提供しなければならない
- REQ-003: システムはRow Level Security (RLS) によるデータアクセス制御を実装しなければならない
- REQ-004: システムはミドルウェアベースのルート保護により未認証ユーザーの保護ページアクセスを制限しなければならない

### フラッシュカード機能要件

#### 通常要件

- REQ-101: システムはデッキとカードの作成・編集・削除機能を提供しなければならない
- REQ-102: システムはTiptapエディタによるリッチテキスト対応のカード作成を提供しなければならない
- REQ-103: システムはFSRSアルゴリズムとSM2アルゴリズムによる間隔反復学習を実装しなければならない
- REQ-104: システムは学習セッション中のカード評価（Again, Hard, Good, Easy）機能を提供しなければならない

#### 条件付き要件

- REQ-105: ユーザーがフラッシュカード学習を実行する場合、システムは間隔反復アルゴリズムに基づいて最適なタイミングでカードを提示しなければならない
- REQ-106: ユーザーがカードを評価した場合、システムは次回復習日を自動計算して保存しなければならない
- REQ-107: デッキが他のユーザーと共有されている場合、システムは適切な権限チェックを実行しなければならない

### ノート・ページ管理要件

#### 通常要件

- REQ-201: システムはTiptapベースのリッチテキストエディタを提供しなければならない
- REQ-202: システムはページ間のリンク機能を実装しなければならない
- REQ-203: システはノートによるページのグルーピング機能を提供しなければならない
- REQ-204: システムはページのバージョン管理機能を実装しなければならない

#### 条件付き要件

- REQ-205: ユーザーがページを削除する場合、システムはゴミ箱に移動し30日後に自動削除しなければならない
- REQ-206: ページが共有されている場合、システムは協同編集機能を提供しなければならない
- REQ-207: ユーザーがページリンクを作成する場合、システムは自動補完とサジェスト機能を提供しなければならない

### AI統合要件

#### 通常要件

- REQ-301: システムはGoogle Gemini APIを使用したコンテンツからのフラッシュカード自動生成を提供しなければならない
- REQ-302: システムは音声ファイルからの文字起こし機能を実装しなければならない
- REQ-303: システムは画像からのOCR（光学文字認識）機能を実装しなければならない
- REQ-304: システムはAIによるタイトル自動生成機能を提供しなければならない

#### 条件付き要件

- REQ-305: ユーザーがAI機能を使用する場合、システムは適切なプロンプトテンプレートを適用しなければならない
- REQ-306: AI処理が失敗した場合、システムは適切なエラーメッセージを表示しなければならない

### 学習機能要件

#### 通常要件

- REQ-401: システムは多肢選択問題の生成と回答機能を提供しなければならない
- REQ-402: システムは穴埋め問題の生成と回答機能を提供しなければならない
- REQ-403: システムは学習セッションの進捗追跡機能を実装しなければならない
- REQ-404: システムは学習ログの記録と統計表示機能を提供しなければならない

#### 条件付き要件

- REQ-405: ユーザーが学習セッションを開始する場合、システムは復習対象カードを自動選択しなければならない
- REQ-406: 学習セッションが完了した場合、システムは学習結果を保存し統計を更新しなければならない

### 学習目標管理要件

#### 通常要件

- REQ-501: システムは学習目標の作成・編集・削除機能を提供しなければならない
- REQ-502: システムは目標の進捗率計算と表示機能を実装しなければならない
- REQ-503: システムは学習目標とデッキの関連付け機能を提供しなければならない

#### 制約要件

- REQ-504: システムは無料プランユーザーの学習目標数を3個まで制限しなければならない
- REQ-505: システムは有料プランユーザーの学習目標数を10個まで制限しなければならない

### 外部サービス統合要件

#### 通常要件

- REQ-601: システムはCosense（Scrapbox）プロジェクトとの同期機能を提供しなければならない
- REQ-602: システムはGyazo OAuth認証と画像統合機能を実装しなければならない
- REQ-603: システムは外部サービスからのデータ差分検出・更新機能を提供しなければならない

#### 条件付き要件

- REQ-604: 外部サービス同期でエラーが発生した場合、システムは適切なエラーハンドリングを実行しなければならない
- REQ-605: ユーザーがGyazo認証を行う場合、システムはOAuthフローを適切に処理しなければならない

### 共有・コラボレーション要件

#### 通常要件

- REQ-701: システムはデッキの共有機能（リンク・ユーザー指定）を提供しなければならない
- REQ-702: システムはページの共有機能（パブリック・プライベート）を提供しなければならない
- REQ-703: システムは一時的な共有リンクと有効期限設定機能を実装しなければならない

#### 条件付き要件

- REQ-704: 共有リンクが期限切れの場合、システムはアクセスを拒否しなければならない
- REQ-705: ユーザーが共有権限を変更する場合、システムは適切な権限チェックを実行しなければならない

### 管理機能要件

#### 通常要件

- REQ-801: システムは管理者向けユーザー管理機能を提供しなければならない
- REQ-802: システムはシステム統計とメトリクス表示機能を実装しなければならない
- REQ-803: システムはお問い合わせ管理機能を提供しなければならない
- REQ-804: システムはチェンジログ管理機能を実装しなければならない

#### 条件付き要件

- REQ-805: 管理者権限を持つユーザーの場合、システムは管理画面へのアクセスを許可しなければならない
- REQ-806: 管理者以外のユーザーが管理画面にアクセスした場合、システムはアクセスを拒否しなければならない

### UI/UX要件

#### 通常要件

- REQ-901: システムはRadix UIベースの40以上のアクセシブルなUIコンポーネントを提供しなければならない
- REQ-902: システムは7種類のカラーテーマ（blue, green, orange, red, rose, violet, yellow）を提供しなければならない
- REQ-903: システムはライト・ダークモードの切り替え機能を実装しなければならない
- REQ-904: システムはレスポンシブデザインによるモバイル対応を提供しなければならない

## 非機能要件

### パフォーマンス要件

- NFR-001: システムはページ読み込み時間を3秒以内に制限しなければならない
- NFR-002: システムはFSRSアルゴリズムによるカード選択処理を1秒以内に完了しなければならない
- NFR-003: システムはデータベースクエリの最適化により応答時間を最小化しなければならない

### セキュリティ要件

- NFR-101: システムはRow Level Security (RLS) により全データアクセスを制御しなければならない
- NFR-102: システムは入力データの適切なサニタイゼーションを実装しなければならない
- NFR-103: システムはJWTトークンベースの認証を使用しなければならない

### ユーザビリティ要件

- NFR-201: システムはWCAG 2.1 AA準拠のアクセシビリティを提供しなければならない
- NFR-202: システムは直感的なナビゲーションとユーザーインターフェースを実装しなければならない
- NFR-203: システムは適切なエラーメッセージとヘルプ機能を提供しなければならない

### 可用性要件

- NFR-301: システムは99.9%以上の稼働率を維持しなければならない
- NFR-302: システムはSupabaseインフラストラクチャの高可用性を活用しなければならない

### 拡張性要件

- NFR-401: システムはNext.js Server Actionsによるスケーラブルなアーキテクチャを実装しなければならない
- NFR-402: システムはReact Queryによる効率的な状態管理を実装しなければならない

## Edgeケース

### エラー処理

- EDGE-001: AI APIレート制限に達した場合の適切なエラーハンドリング
- EDGE-002: データベース接続エラー時のフォールバック処理
- EDGE-003: 大容量ファイル（音声・画像）アップロード時の制限とエラー処理
- EDGE-004: 同時編集時の競合検出と解決処理

### 境界値

- EDGE-101: デッキ内カード数の上限（1000枚）到達時の処理
- EDGE-102: ページコンテンツサイズの制限（10MB）超過時の処理
- EDGE-103: 学習セッションの最大継続時間（4時間）制限
- EDGE-104: 同時接続ユーザー数の制限

### 例外的状況

- EDGE-201: ネットワーク断続時のオフライン機能
- EDGE-202: 外部サービス（Cosense, Gyazo）のサービス停止時の処理
- EDGE-203: ユーザーアカウント削除時の関連データ処理
- EDGE-204: 大量データマイグレーション時のパフォーマンス維持

## 受け入れ基準

### 機能テスト

#### 認証・セキュリティ
- [ ] Google OAuth認証フローが正常に動作する
- [ ] マジックリンク認証が正常に動作する
- [ ] 未認証ユーザーが保護ページにアクセスできない
- [ ] RLSポリシーによりユーザーは自分のデータのみアクセス可能

#### フラッシュカード機能
- [ ] デッキとカードの作成・編集・削除が正常に動作する
- [ ] リッチテキストエディタでカード内容を編集できる
- [ ] FSRSアルゴリズムによる間隔反復学習が動作する
- [ ] カード評価（Again, Hard, Good, Easy）により次回復習日が計算される

#### ノート・ページ管理
- [ ] リッチテキストエディタでページ作成・編集が可能
- [ ] ページ間リンク機能が正常に動作する
- [ ] ノートによるページグルーピングが機能する
- [ ] ゴミ箱機能によりページの論理削除・復元が可能

#### AI統合機能
- [ ] テキストからフラッシュカードの自動生成が動作する
- [ ] 音声ファイルからの文字起こしが正常に実行される
- [ ] 画像からのOCR処理が正確に動作する
- [ ] タイトル自動生成機能が適切に動作する

#### 学習機能
- [ ] 多肢選択問題と穴埋め問題の生成・回答が動作する
- [ ] 学習セッションの進捗が正確に追跡される
- [ ] 学習統計が正確に計算・表示される

#### 学習目標管理
- [ ] 学習目標の作成・編集・削除が正常に動作する
- [ ] 進捗率が正確に計算・表示される
- [ ] プラン別の目標数制限が適用される

#### 外部サービス統合
- [ ] Cosense同期機能が正常に動作する
- [ ] Gyazo OAuth認証と画像統合が機能する
- [ ] 差分検出・更新処理が正確に実行される

#### 共有・コラボレーション
- [ ] デッキとページの共有機能が正常に動作する
- [ ] 権限設定（読み取り専用・編集可能）が適用される
- [ ] 一時共有リンクの有効期限が適切に管理される

#### 管理機能
- [ ] 管理者画面へのアクセス制御が機能する
- [ ] ユーザー管理機能が正常に動作する
- [ ] システム統計が正確に表示される
- [ ] お問い合わせ管理が機能する

### 非機能テスト

#### パフォーマンス
- [ ] ページ読み込み時間が3秒以内
- [ ] データベースクエリ応答時間が1秒以内
- [ ] 大量データ処理時のメモリ使用量が適切な範囲内

#### セキュリティ
- [ ] SQLインジェクション攻撃に対する保護
- [ ] XSS攻撃に対する保護
- [ ] 不正なファイルアップロードの防止
- [ ] 認証トークンの適切な管理

#### ユーザビリティ
- [ ] モバイルデバイスでの適切な表示
- [ ] アクセシビリティガイドライン（WCAG 2.1 AA）への準拠
- [ ] エラーメッセージの分かりやすさ
- [ ] 直感的なユーザーインターフェース

#### 互換性
- [ ] 主要ブラウザ（Chrome, Firefox, Safari, Edge）での動作
- [ ] 異なる画面サイズでのレスポンシブ表示
- [ ] PWA機能の適切な動作

### 統合テスト

#### データフロー
- [ ] 認証からダッシュボード表示までの完全なフロー
- [ ] フラッシュカード作成から学習セッション完了までのフロー
- [ ] ページ作成から共有・協同編集までのフロー
- [ ] AI機能を使用したコンテンツ生成フロー

#### 外部サービス統合
- [ ] Supabase Authとの統合テスト
- [ ] Google Gemini APIとの統合テスト
- [ ] Cosense APIとの統合テスト
- [ ] Gyazo APIとの統合テスト

## 実装優先度

### フェーズ1（Core機能）
1. 認証・ユーザー管理システム
2. 基本的なフラッシュカード機能
3. ノート・ページ管理基盤
4. ダッシュボード機能

### フェーズ2（拡張機能）
1. AI統合機能
2. 間隔反復学習アルゴリズム
3. 学習目標管理
4. 共有・コラボレーション機能

### フェーズ3（高度機能）
1. 外部サービス統合
2. 管理機能
3. 高度なUI/UX機能
4. パフォーマンス最適化

## 技術的制約

### 技術スタック制約
- フロントエンド: Next.js 15 + React 19 + TypeScript
- バックエンド: Supabase（PostgreSQL + Auth + Storage）
- スタイリング: Tailwind CSS + Radix UI
- パッケージマネージャー: Bun

### 外部サービス依存
- Google Gemini API（AI機能）
- Cosense API（知識ベース同期）
- Gyazo API（画像管理）
- Supabase インフラストラクチャー

### パフォーマンス制約
- データベース: Supabaseの制限内での運用
- API制限: 各外部サービスのレート制限遵守
- ファイルサイズ: 音声・画像ファイルの適切な制限

---

**文書作成日**: 2025-08-03  
**バージョン**: 1.0  
**対象リリース**: 全機能実装版  
**承認状況**: レビュー待ち